<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ERDucate Lesson 3 - Multi Game</title>
<link rel="icon" href="ERDucate.ico">
<style>  
 /* ===== Base Styles ===== */
body {
    font-family: 'Poppins', sans-serif;
    background: url('Background-game-Lesson1.png') no-repeat center center fixed;
    background-size: cover;
    color: #333;
    max-width: 980px;
    margin: 0 auto;
    padding: 20px;
    transition: background-image 0.5s ease-in-out;
}
body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.6);
    z-index: -1;
}
header {
    background: #800000;
    color: #fff;
    padding: 12px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 8px;
}
header .title {
    font-size: 18px;
    font-weight: 600;
}
header .btn-group button,
header .btn-group a {
    border: 2px solid #fff;
    background: transparent;
    color: #fff;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    margin-left: 8px;
    font-size: 13px;
    cursor: pointer;
}
header .btn-group button:hover,
header .btn-group a:hover {
    background: #fff;
    color: #800000;
}
h1 {
    text-align: center;
    color: #800000;
    margin: 18px 0;
}
.hidden {
    display: none;
}

/* ===== Columns & Cards ===== */
.column-container,
.match-container {
    display: flex;
    flex-wrap: wrap; /* para bumaba sa next row sa maliit na screen */
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}
.column-box,
.sort-box {
    border: 2px dashed #800000;
    border-radius: 8px;
    padding: 10px;
    background: #fff;
    text-align: center;
    min-width: 150px;
    width: 200px;
    box-sizing: border-box;
    flex: 1 1 180px;
    min-height: 180px;
}
.card,
.match-item {
    padding: 8px 12px;
    background: #fff;
    border: 2px solid #800000;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    margin: 4px 0;
    text-align: center;
    flex-shrink: 0;
}
#items {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
}

/* Matching Game */
.entity-col,
.rel-col {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.selected {
    background: #28a745;
    color: #fff;
}

/* Modal */
.modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 0.3s ease;
}
.modal-bg.hidden {
    opacity: 0;
    pointer-events: none;
}
.modal {
    background: white;
    padding: 20px 28px;
    border-radius: 10px;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}
.modal h2 {
    margin-bottom: 12px;
    color: #800000;
}

/* CTA Button */
.cta-btn {
    display: inline-block;
    background: #800000;
    color: #fff;
    padding: 12px 22px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 16px;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    cursor: pointer;
}
.cta-btn:hover {
    background: #a00000;
    transform: scale(1.05);
}

/* Congrats Message */
#congratsMessage {
    text-align: center;
    font-size: 32px;
    font-weight: bold;
    color: #28a745;
    margin: 30px 0;
}
#progressBtnContainer {
    text-align: center;
    margin-bottom: 60px;
}

/* ===== Responsive Adjustments ===== */

/* Tablets & smaller desktops */
@media (max-width: 1024px) {
    body { padding: 10px; }
    header {
        flex-direction: column;
        text-align: center;
    }
    header .btn-group { margin-top: 10px; }
}

/* Tablets & large phones */
@media (max-width: 768px) {
    h1 { font-size: 20px; }
    .cta-btn {
        font-size: 14px;
        padding: 10px 16px;
        width: 100%;
        text-align: center;
    }
    .column-container,
    .match-container {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }
    .column-box,
    .sort-box {
        width: 45%;  /* 2 columns per row */
        min-width: 140px;
        min-height: 160px;
    }
    .entity-col,
    .rel-col {
        width: 45%;
        align-items: center;
    }
    .modal { width: 90%; }
}

/* Small phones */
@media (max-width: 480px) {
    body { padding: 8px; }
    h1 { font-size: 18px; }
    header .title { font-size: 16px; }
    #congratsMessage { font-size: 22px; }
    .cta-btn {
        font-size: 13px;
        padding: 8px 12px;
        width: 95%;
        margin: 0 auto;
    }
    .card,
    .match-item {
        font-size: 13px;
        padding: 6px 10px;
    }
    .column-box,
    .sort-box {
        width: 90%;
        min-width: auto;
        min-height: 150px;
        margin-bottom: 12px;
    }
    .entity-col,
    .rel-col {
        width: 90%;
    }
    .match-container {
        gap: 15px;
        flex-direction: column;
    }
}



</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<audio id="successSound" src="ClappLesson1.mp3"></audio>
<audio id="bgMusic" src="BackgroundLesson1.mp3" loop></audio>

<header>
  <div class="title">Lesson 3 ‚Äî Multi-Game Entities</div>
  <div class="btn-group">
    <button id="musicBtn" onclick="toggleMusic(this)">üîä Mute</button>
    <a href="quiz3.html">üìã Back to Quiz</a>
    <a href="index.html">üè† Home</a>
  </div>
</header>

<!-- Game Mechanics Popup -->
<div id="gameMechanics" class="modal hidden">
  <div class="modal-content">
    <h2>üìò Game Mechanics</h2>
    <p>Welcome to the ERDucate Click Game!</p>
    <ul style="text-align:left; max-width:400px; margin:10px auto;">
      <li>üéØ Stage 1: Identify correct Entities in different scenes.</li>
      <li>üóÇÔ∏è Stage 2: Sort attributes into Student or Teacher categories.</li>
      <li>üîó Stage 3: Match entities with their correct relationships.</li>
      <li>‚ùå Wrong answers reduce your <strong>5 chances</strong>.</li>
      <li>‚úÖ Complete all scenes to unlock your achievement!</li>
    </ul>
    <button class="cta-btn" onclick="startMechanics()">Start Game</button>
  </div>
</div>


<h1 id="roundTitle">Scene 1</h1>
<p style="text-align:center;">‚ù§Ô∏è Chances left: <span id="chanceDisplay">5</span></p>
<div id="roundsWrapper"></div>

<div id="progressBtnContainer" class="hidden">
  <div id="congratsMessage" class="hidden">üéâ Congratulations! You completed Lesson 3! üéâ</div>
  <a href="progress.html" class="cta-btn">üìä View Your Progress</a>
</div>

<!-- Intro Modals -->
<div id="introEntities" class="modal-bg hidden">
  <div class="modal"> 
  <h2>üìò Game Mechanics</h2>
  <ul style="text-align:left; margin:10px auto; max-width:420px;">
    <li>You have <strong>5 chances</strong> in the whole game.</li>
    <li>There are 3 stages:
      <ul>
        <li><strong>Stage 1</strong>: Choose Entities</li>
        <li><strong>Stage 2</strong>: Sort Attributes</li>
        <li><strong>Stage 3</strong>: Match Relationships</li>
      </ul>
    </li>
    <li>Noise items don‚Äôt belong anywhere ‚Äî just remove them.</li>
    <li>Finish all stages to complete the game üéâ</li>
  </ul>

  <hr style="margin:15px 0;">

  <h3>üéØ Stage 1 Mechanics</h3>
  <p style="margin:10px auto; max-width:400px;">
    Tap a <strong>word card</strong>, then tap the correct <strong>Entity box</strong>.  
    Remove all items (including noise) to finish the round.
  </p>
  <button class="cta-btn" onclick="startStage(1)">Start Stage 1</button>
</div>
<div id="introSorting" class="modal-bg hidden">
  <div class="modal">
    <h2>Stage 2: Sorting Attributes</h2>
    <p>Tap an attribute, then tap Student or Teacher.</p>
    <button class="cta-btn" onclick="startStage(2)">Start Stage 2</button>
  </div>
</div>
<div id="introMatching" class="modal-bg hidden">
  <div class="modal">
    <h2>Stage 3: Matching Relationships</h2>
    <p>Tap an Entity, then tap the correct Relationship.</p>
    <button class="cta-btn" onclick="startStage(3)">Start Stage 3</button>
  </div>
</div>

<script>
let chances = 5;
let roundIndex = 0;
let currentStage = 1;
let selectedCard = null;

// Stage 1: Entities
const roundsEntities = [
  { title: 'Scene 1 ‚Äî School', entities: ['Student', 'Teacher', 'Classroom'], items: [
      { text: 'Juan Dela Cruz', type: 'Student', rationale: 'Juan is a Student in the School.' },
      { text: 'Teacher Ana', type: 'Teacher', rationale: 'Teacher Ana is the Teacher.' },
      { text: 'Room 201', type: 'Classroom', rationale: 'Room 201 is a Classroom.' },
      { text: 'Notebook', type: 'noise', rationale: 'This is irrelevant for the scene.' }
    ] },
  { title: 'Scene 2 ‚Äî Library', entities: ['Book', 'Librarian', 'Section'], items: [
      { text: 'Science Book', type: 'Book', rationale: 'Science Book is a Book in the Library.' },
      { text: 'Mr. Santos', type: 'Librarian', rationale: 'Mr. Santos is the Librarian.' },
      { text: 'Reference Section', type: 'Section', rationale: 'Reference Section is part of Library.' },
      { text: 'Stapler', type: 'noise', rationale: 'This is irrelevant for the scene.' }
    ] },
  { title: 'Scene 3 ‚Äî Store', entities: ['Customer', 'Cashier', 'Product'], items: [
      { text: 'Maria Lopez', type: 'Customer', rationale: 'Maria Lopez is a Customer.' },
      { text: 'Cashier Jose', type: 'Cashier', rationale: 'Cashier Jose is the Cashier.' },
      { text: 'Milk', type: 'Product', rationale: 'Milk is a Product sold in Store.' },
      { text: 'Umbrella', type: 'noise', rationale: 'This is irrelevant for the scene.' }
    ] }
];

// Stage 2: Sorting
const roundsSorting = [
  { title: 'Scene 4 ‚Äî Sorting 1', student: ['Name', 'Grade', 'Age'], teacher: ['Teacher', 'Classroom'], rationale: 'Student attributes go to Student, Teacher attributes go to Teacher.' },
  { title: 'Scene 5 ‚Äî Sorting 2', student: ['StudentID', 'Course', 'Address'], teacher: ['TeacherName', 'Department'], rationale: 'Sort attributes to their correct group.' },
  { title: 'Scene 6 ‚Äî Sorting 3', student: ['Email', 'Birthday'], teacher: ['Subject', 'Salary'], rationale: 'Students have personal info, Teachers have job info.' }
];

// Stage 3: Matching
const roundsMatching = [
  { title: 'Scene 7 ‚Äî Match 1', pairs: { 'Student': 'Class', 'Teacher': 'Subject', 'Customer': 'Product' }, rationale: 'Match entities to their appropriate relationships.' },
  { title: 'Scene 8 ‚Äî Match 2', pairs: { 'Doctor': 'Patient', 'Author': 'Book', 'Driver': 'Car' }, rationale: 'Entities must connect with logical counterparts.' },
  { title: 'Scene 9 ‚Äî Match 3', pairs: { 'Buyer': 'Item', 'Singer': 'Song', 'Player': 'Team' }, rationale: 'Match each entity to its related object.' }
];

const wrapper = document.getElementById('roundsWrapper');
const successSound = document.getElementById('successSound');
const bgMusic = document.getElementById('bgMusic');
const roundTitle = document.getElementById('roundTitle');
const chanceDisplay = document.getElementById('chanceDisplay');

const introEntities = document.getElementById('introEntities');
const introSorting = document.getElementById('introSorting');
const introMatching = document.getElementById('introMatching');

function toggleMusic(btn){
  if (bgMusic.paused) { bgMusic.play(); btn.textContent = "üîä Mute"; }
  else { bgMusic.pause(); btn.textContent = "üîá Unmute"; }
}

window.onload = () => {
  introEntities.classList.remove('hidden');
  roundIndex = 0;
  currentStage = 1;
  chances = 5;
  chanceDisplay.textContent = chances;
};

// ---------- START STAGES ----------
function startStage(stage){
  [introEntities, introSorting, introMatching].forEach(m => m && m.classList.add('hidden'));
  currentStage = stage;
  if (stage === 1) roundIndex = 0;
  if (stage === 2) roundIndex = 3;
  if (stage === 3) roundIndex = 6;
  renderScene();
  if (bgMusic.paused) bgMusic.play();
}

function renderScene(){
  if (roundIndex < 3) { renderEntities(roundsEntities[roundIndex]); return; }
  if (roundIndex < 6) { renderSorting(roundsSorting[roundIndex - 3]); return; }
  if (roundIndex < 9) { renderMatching(roundsMatching[roundIndex - 6]); return; }
  showAnalysis();
}

// ---------- GAME 1: ENTITIES ----------
function renderEntities(r){
  roundTitle.textContent = r.title;
  wrapper.innerHTML = `
    <p style="text-align:center;">Tap a card, then tap the correct Entity box.</p>
    <div class="column-container">
      ${r.entities.map(c => `<div class="column-box" data-type="${c}"><strong>${c}</strong></div>`).join('')}
    </div>
    <div id="items">
      ${r.items.map(i => `<div class="card" data-type="${i.type}" data-rationale="${i.rationale}">${i.text}</div>`).join('')}
    </div>
  `;
  initClickEntities();
}

function initClickEntities(){
  selectedCard = null;
  document.querySelectorAll('#items .card').forEach(card => {
    card.onclick = () => {
      selectedCard = card;
      document.querySelectorAll('#items .card').forEach(c => c.style.background = "");
      card.style.background = "#ffd966";
    };
  });
  document.querySelectorAll('.column-box').forEach(box => {
    box.onclick = () => {
      if (!selectedCard) return;
      if (selectedCard.dataset.type === box.dataset.type || selectedCard.dataset.type === 'noise') {
        const div = document.createElement('div');
        if (selectedCard.dataset.type !== 'noise') {
          div.textContent = selectedCard.textContent + " ‚úî";
          div.style.color = "green";
          box.appendChild(div);
        }
        selectedCard.remove();
        selectedCard = null;
        if (allPlaced()) nextRound();
      } else {
        wrongAnswer();
      }
    };
  });
}

function allPlaced(){
  const remain = document.querySelectorAll('#items .card');
  return remain.length === 0 || [...remain].every(r => r.dataset.type === 'noise');
}

// ---------- GAME 2: SORTING ----------
function renderSorting(r){
  roundTitle.textContent = r.title;
  const allItems = [
    ...r.student.map(x => ({ text: x, type: 'Student' })),
    ...r.teacher.map(x => ({ text: x, type: 'Teacher' }))
  ];
  shuffle(allItems);
  wrapper.innerHTML = `
    <p style="text-align:center;">Tap an attribute, then tap Student or Teacher.</p>
    <div class="column-container">
      <div class="sort-box" data-type="Student"><strong>Student</strong></div>
      <div class="sort-box" data-type="Teacher"><strong>Teacher</strong></div>
    </div>
    <div id="items">
      ${allItems.map(i => `<div class="card" data-type="${i.type}" data-rationale="${r.rationale}">${i.text}</div>`).join('')}
    </div>
  `;
  initClickSorting();
}

function initClickSorting(){
  selectedCard = null;
  document.querySelectorAll('#items .card').forEach(card => {
    card.onclick = () => {
      selectedCard = card;
      document.querySelectorAll('#items .card').forEach(c => c.style.background = "");
      card.style.background = "#ffd966";
    };
  });
  document.querySelectorAll('.sort-box').forEach(box => {
    box.onclick = () => {
      if (!selectedCard) return;
      if (selectedCard.dataset.type === box.dataset.type) {
        const div = document.createElement('div');
        div.textContent = selectedCard.textContent + " ‚úî";
        div.style.color = "green";
        box.appendChild(div);
        selectedCard.remove();
        selectedCard = null;
        if (document.querySelectorAll('#items .card').length === 0) nextRound();
      } else {
        wrongAnswer();
      }
    };
  });
}

// ---------- GAME 3: MATCHING ----------
let selectedEntity = null;
function renderMatching(r){
  roundTitle.textContent = r.title;
  const entities = Object.keys(r.pairs);
  const rels = Object.values(r.pairs);
  shuffle(rels);
  wrapper.innerHTML = `
    <p style="text-align:center;">Match Entities with Relationships. Tap an Entity, then a Relationship.</p>
    <div class="match-container">
      <div class="entity-col">
        ${entities.map(e => `<div class="match-item entity" data-entity="${e}">${e}</div>`).join('')}
      </div>
      <div class="rel-col">
        ${rels.map(rel => `<div class="match-item rel" data-rel="${rel}">${rel}</div>`).join('')}
      </div>
    </div>
  `;
  initMatching(r.pairs, r.rationale);
}

function initMatching(pairs, rationale){
  selectedEntity = null;
  document.querySelectorAll('.entity').forEach(ent => {
    ent.onclick = () => {
      document.querySelectorAll('.entity').forEach(e => e.classList.remove('selected'));
      ent.classList.add('selected');
      selectedEntity = ent.dataset.entity;
    };
  });
  document.querySelectorAll('.rel').forEach(rel => {
    rel.onclick = () => {
      if (!selectedEntity) return;
      const expected = pairs[selectedEntity];
      if (rel.dataset.rel === expected) {
        rel.style.background = "#28a745"; 
        rel.style.color = "#fff"; 
        rel.dataset.matched = "true";
        const entEl = document.querySelector(`.entity[data-entity="${selectedEntity}"]`);
        if (entEl) entEl.style.background = "#28a745";
        selectedEntity = null;
        if ([...document.querySelectorAll('.rel')].every(r => r.dataset.matched === "true")) {
          nextRound();
        }
      } else {
        wrongAnswer();
      }
    };
  });
}

// ---------- COMMON ----------
function wrongAnswer(){
  chances--;
  chanceDisplay.textContent = chances;
  alert("‚ùå Wrong answer. Try again!");
  if (chances <= 0) {
    alert("Game Over! Try again.");
    location.reload();
  }
}

function nextRound(){
  successSound.play();
  roundIndex++;
  renderScene();
}

function showAnalysis(){
  wrapper.innerHTML = "";
  document.getElementById('congratsMessage').classList.remove('hidden');
  document.getElementById('progressBtnContainer').classList.remove('hidden');
  launchConfetti();
  markGameComplete();
}

function launchConfetti(){
  confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
}

function markGameComplete(){
  const users = JSON.parse(localStorage.getItem("users")) || {};
  const currentUser = localStorage.getItem("loggedInUser") || "DemoUser";
  if (!users[currentUser]) users[currentUser] = { progress:{} };
  users[currentUser].progress["game3"] = true;
  localStorage.setItem("users", JSON.stringify(users));
}

// Utility: shuffle array
function shuffle(array){
  for (let i = array.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function markGameComplete(){
  const users = JSON.parse(localStorage.getItem("users")) || {};
  const currentUser = localStorage.getItem("loggedInUser") || "DemoUser";
  if (!users[currentUser]) users[currentUser] = { progress:{} };
  users[currentUser].progress["game3"] = true;
  localStorage.setItem("users", JSON.stringify(users));
}

// Auto show Stage 1 intro on load
window.onload = () => {
  introEntities.classList.remove('hidden');
  roundIndex = 0;
  currentStage = 1;
  chances = 5;
  chanceDisplay.textContent = chances;
};
</script>
